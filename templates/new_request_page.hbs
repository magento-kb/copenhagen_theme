<div class="container-divider"></div>
<div id="searchbox"></div>
<div class="container">
  <nav class="sub-nav">
    {{breadcrumbs}}
  </nav>
  <div class="extension info">
    <div>
      Data Privacy Notice
    </div>
    <div>
      Adobe technical support may require access to your Adobe Commerce related data in order to provide support. The primary Adobe Commerce account holder can choose to provide this authorization in their Adobe Commerce account privacy settings. Allowing this access prior to  support request creation will help ensure the issue can be properly investigated and/or help increase the speed of resolution.
      <br>
      For more information, please visit: 
      <a href='https://experienceleague.adobe.com/docs/commerce-knowledge-base/kb/announcements/commerce-announcements/adobe-support-customer-data-access-and-privacy.html?lang=en' target='_blank'>Adobe support customer data access and privacy</a>
    </div>
  </div>
  <h1>
    {{t 'submit_a_request'}}
    <span class="follow-up-hint">
      {{follow_up}}
    </span>
  </h1>
  <div id="main-content" style="display:flex;">
    <div style="flex: 50%; margin-right:30px" class="form">
      {{request_form wysiwyg=true}}
    </div>
    <CoveoCaseDeflection style="flex: 50%; margin-top:18px">
      <div id="case-deflection-text" class="case-deflection-text">
        <h2 style="margin-bottom: 5px;">Suggested Articles</h2>
        <p style="margin: 5px 0 5px 0; font-size:15px; color: #313a45;">Based on your input and browsing, here are some articles we think can solve your issue.</p>
      </div>
    </CoveoCaseDeflection>
  </div>
</div>

<script>
  $("body").addClass("no-subfooter");
  $(".submit-a-request").addClass("hide");
  let date = null;
  document.addEventListener("DOMContentLoaded", function(event) {
    let caseDeflectionComponent = null;
    setTimeout(() => {
      while(caseDeflectionComponent == null) {
        caseDeflectionComponent = document.getElementById('CoveoSearch')
      }
      caseDeflectionComponent.prepend(document.getElementById('case-deflection-text'))
    }, "500");
  });

  //add target blank to existing and future links in the case deflection component
  //links will change and need to add event listener to the case deflection component
  //to add the target blank to the links
  document.addEventListener("DOMContentLoaded", function(event) {
    let caseDeflectionComponent = null;
    setTimeout(() => {
      while(caseDeflectionComponent == null) {
        caseDeflectionComponent = document.getElementById('CoveoSearch')
      }
      let links = caseDeflectionComponent.getElementsByTagName('a');
      for (let i = 0; i < links.length; i++) {
        links[i].setAttribute('target', '_blank');
      }
      caseDeflectionComponent.addEventListener('DOMNodeInserted', function(e) {
        let links = caseDeflectionComponent.getElementsByTagName('a');
        for (let i = 0; i < links.length; i++) {
          links[i].setAttribute('target', '_blank');
        }
      });
    }, "500");
  });
  //add event listener to form id="new_request" that will obtain the value of input id="request_custom_fields_360029532732"

    document.addEventListener("DOMContentLoaded", function(e) {
      let input = document.querySelector('.request_custom_fields_360029532732');
      if(input) {
        input.addEventListener('change', function(e) {
          let value = e.target.value;
          date = new Date(value);
          //get the current date
          let currentDate = new Date();
          //get the difference between the current date and the date selected in calendar days
          let diff = Math.floor((Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()) - Date.UTC(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate())) /(1000 * 60 * 60 * 24));
          console.log(diff)
          if (diff < 2) {
            alert('Requests for Temporary Cloud Project Upsizes should be submitted 48 hours (2 days) in advance of the requested start date/time. We cannot guarantee upsizes with less than 48 hours (2 days) advanced notice to be completed by the selected start date/time.');
          }
          //if date selected is not 2 calendar days in the future show alert pop up
          console.log(value);
        });
      }
    })

    document.addEventListener("DOMContentLoaded", function(e) {
      let input = document.querySelector('.request_custom_fields_360029597131');
      if(input) {
        input.addEventListener('change', function(e) {
          let value = e.target.value;
          //change value from date format Month day, year to mm/dd/yyyy
          let endDate = new Date(value);
          {{!-- let currentDate = new Date(); --}}
          let diff = Math.floor((Date.UTC(endDate.getFullYear(), endDate.getMonth(), endDate.getDate()) - Date.UTC(date.getFullYear(),
          date.getMonth(), date.getDate())) /(1000 * 60 * 60 * 24));
          if(diff < 0) {
            alert('Your selected date cannot be before the start date');
          } 
          console.log(date);
          console.log(diff);
        });
      }
    })
</script>

